{% extends "monosaur/base.html" %}

{% block content %}
  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <h1>Transaction file upload</h1>
        <form action="/analyse/" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="file" name="ofx_file">
          <button type="submit">Upload</button>
        </form>

        <hr>

        <h1>Personal finance analytics</h1>

        <canvas id="analytics_barchart"></canvas>
          <script>
          var ctx = document.getElementById("analytics_barchart");
          var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: {{ chart_labels|safe }},
                  datasets: [{
                      label: 'Average monthly spend',
                      data: {{ chart_values }},
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)',
                      ],
                      borderColor: [
                          'rgba(255,99,132,1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });
          </script>
        <hr>

        <h1>Transaction List</h1>

          <!-- display list of transactions here -->

          <table class="table">
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Transaction</th>
              <th>Type</th>
              <th>Subscription</th>
              <th>Amount</th>
            </tr>

            {% for transaction in transactions %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ transaction.date }}</td>
              <td>{{ transaction.name }}</td>
              <td>{{ transaction.category }}</td>
              <td>{{ transaction.subscription }}</td>
              <td>{{ transaction.amount|floatformat:2 }}</td>
            </tr>
            {% endfor %}

          </table>

      </div>
    </div>
  </div>
{% endblock %}
